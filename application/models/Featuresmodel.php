<?php

class FeaturesModel extends CI_Model{


	function __construct(){

		parent::__construct();
	}


	function getProductDetails($barCode){

		$Query = $this->db->get_where('retail_purchase',array('item_bar_code'=>$barCode));

		return $Query->row();
	}

	function saveAndUpdateDetails(){

		$updateData = array(
								'item_sale_price' => $this->input->post('sr_saleprice',true),
								'item_qty' => $this->input->post('sr_qty',true),
								'item_expiry' => $this->input->post('sr_expiry',true),
								'free_item_barcode' => $this->input->post('sr_freebarcode',true),
								'free_item_name' => $this->input->post('sr_freename',true),
								'free_item_qty' => $this->input->post('sr_freeqty',true),
								'free_item_mrp' => $this->input->post('sr_itemmrp',true),
								'last_update' => date('Y-m-d H:i:s')
						   );

		$Query = $this->db->where('id',$this->input->post('sr_id',true))->update('retail_purchase',$updateData);
		if($Query){

			return true;
		}else{

			return false;
		}
	}

	function getWhereNull(){

		$Query = $this->db->
		or_where('item_qty',0)->
		or_where('item_expiry','0000-00-00')->
		or_where('item_expiry','0000-00-00')->
		or_where('item_sale_price',0)->
		get('retail_purchase');

		return $Query->result();
	}

	function uploadRetailStockData(){

        $result = $this->csvreader->parse_file('stockupload.csv');

        $categoryID = array('8902102160144'=>2,'8902102160168'=>2,'8902102160212'=>2,'8901012115152'=>3,'8901012111024'=>3,'8904063200013'=>5,'8904063200051'=>5,'8904063200174'=>5,'8904063200204'=>5,'8904063200464'=>5,'8904063200181'=>5,'8904063200440'=>5,'8901063016590'=>6,'8901063092297'=>6,'8901063016569'=>6,'8901063162143'=>6,'8901063163065'=>6,'8901030541292'=>7,'8901396476009'=>11,'8901396151005'=>11,'8901207503023'=>11,'8901764022401'=>12,'8901764012501'=>12,'8901764052408'=>12,'8908001158305'=>15,'8908001158244'=>15,'8908001158312'=>15,'8908001158350'=>15,'8901023005800'=>16,'8901030341663'=>16,'8901396010005'=>16,'8901030556500'=>16,'4902430668538'=>16,'8901030578410'=>16,'4902430672191'=>16,'8901030584121'=>16,'8901396112006'=>17,'8902102199427'=>17,'8901030391156'=>17,'8901030584442'=>17,'8901138512187'=>20,'8901138512460'=>20,'8901030483134'=>20,'8901030565304'=>20,'8906016050812'=>21,'8901526204472'=>21,'8901526204465'=>21,'8901526204458'=>21,'8906016050799'=>21,'8906016050805'=>21,'8901644000734'=>22,'89002827'=>23,'8906014201308'=>23,'8906014201209'=>23,'8906014765961'=>23,'8906014765985'=>23,'8906014765992'=>23,'8901088055802'=>23,'8901088021692'=>23,'8901088045681'=>23,'8901088067744'=>23,'8906014765947'=>23,'8901396352204'=>23,'8901088050418'=>23,'8901088050166'=>23,'8901088076104'=>23,'8901207019005'=>23,'8901207019029'=>23,'89006825'=>23,'8901314032058'=>23,'8901396387404'=>25,'8901571001088'=>26,'8901571000036'=>26,'8901233018355'=>26,'8901233018331'=>26,'8902102198833'=>29,'8901725181222'=>31,'8901058842722'=>31,'8901058842746'=>31,'8901058843590'=>31,'8901157025033'=>35,'8901157025217'=>35,'8901396350200'=>35,'8902102194927'=>35,'8901157025200'=>35,'8906014642941'=>39,'8906014643030'=>39,'8906014643023'=>39,'8906014643016'=>39,'8908000258013'=>39,'8906014642491'=>39,'8906014642484'=>39,'8906014642477'=>39,'8908000258044'=>39,'8906014643719'=>39,'8906014643870'=>39,'8906014643788'=>39,'690225103138'=>40,'690225103626'=>40,'690225104197'=>40,'690225103633'=>40,'690225106092'=>40,'8904043901015'=>42,'808042000435'=>43,'8901030573262'=>43,'8901030573255'=>43,'8904135205038'=>44,'8902979022989'=>44,'808042000442'=>44,'4902430545259'=>44,'4902430619400'=>44,'8901030557767'=>44,'4902430651530'=>44,'4902430646437'=>44,'4902430658485'=>44,'8901030557750'=>44,'8901396332114'=>46,'8901491503020'=>47,'8901491503037'=>47,'8901491503013'=>47,'8901725198329'=>47,'8901023007408'=>48,'8901023007477'=>48,'8901012112359'=>48,'8906022260274'=>48,'8901023007415'=>48,'8901023009426'=>48,'8901023007446'=>48,'8901030462429'=>48,'8901023011085'=>48,'8901396398387'=>48,'8901396397380'=>48,'8901030555510'=>48,'8901030533006'=>49,'8901030535048'=>49,'8902167000065'=>50,'8902167000300'=>50,'8902167000317'=>50,'8902167000140'=>50,'8902167000089'=>50,'8902167000102'=>50,'8902167000164'=>50,'8902167000218'=>50,'8901192107626'=>50,'8901192107220'=>50,'8901192106629'=>50,'8901192106223'=>50,'8901192104229'=>50,'8902167000737'=>50,'8902167000034'=>50,'8901192219220'=>50,'8901192104625'=>50,'8901030323751'=>54,'8901052010615'=>55,'8901052021192'=>55,'8901052024315'=>55,'8901052010318'=>55,'8901052000807'=>55,'8901052010417'=>55,'8901030450389'=>55,'8901030560989'=>55,'8901030546471'=>55,'8901030553608'=>55,'89006733'=>56,'89006740'=>56,'8901207089107'=>57,'8901207000324'=>57,'8901314021045'=>57,'8901314010131'=>57,'8901571004614'=>57,'8901314114419'=>57,'8901571004096'=>57,'8901314010520'=>57,'8901314114525'=>57,'8901314081025'=>57,'8901314019257'=>57,'8901030468094'=>57,'8901030468087'=>57,'8901314009173'=>57,'8901030486548'=>57,'8901314009517'=>57,'8901030486524'=>57,'8908001589024'=>58,'8908001589031'=>58);

        echo "<pre/>";
        print_r($result);
        foreach($result as $key => $value){
        	$category = @$categoryID[$value['BARCODE']];
        	if($category == ''){
        		$category = 0;
        	}
        	$exploded = explode(' ',$value['PRODUCT']);
        	$insert = array(
        						'bill_num_id'			=>	38,
        						'item_category'			=>	$category,
        						'item_bar_code'			=>	$value['BARCODE'],
        						'item_name'				=>	$value['PRODUCT'],
        						'item_desc'				=>	$value['PRODUCT'],
        						'item_mrp'				=>	$value['MRP'],
        						'item_unit'				=>	'PC',
        						'item_sale_price'		=>	$value['SALE RATE'],
        						'item_purchase_price'	=>	$value['PURCHASE RATE'],
        						'item_qty'				=>	0,
        						'item_sku'				=>	$exploded[0].'145',
        						'item_expiry'			=>	'0000-00-00',
        						'free_item_barcode'		=>	'',
        						'free_item_name'		=>	'',
        						'free_item_qty'			=>	'',
        						'free_item_mrp'			=>	''
        				   );
        	$this->db->insert('retail_purchase', $insert);
        }
	}
}